<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>blog-ydnaz - misc</title><link href="/" rel="alternate"></link><link href="/feeds/misc.atom.xml" rel="self"></link><id>/</id><updated>2023-09-24T20:09:50+07:00</updated><entry><title>Podman Container</title><link href="/Podman,%20Linux,%20Container.html" rel="alternate"></link><published>2021-11-15T23:59:51+07:00</published><updated>2023-09-24T20:09:50+07:00</updated><author><name>me</name></author><id>tag:None,2021-11-15:/Podman, Linux, Container.html</id><summary type="html">&lt;p&gt;Podman Container an alternative container to docker and LXC&lt;/p&gt;</summary><content type="html">&lt;p&gt;Podman is the new platform technology from Redhat to manage, build and run container. It will compete with the already existed container in linux ecosystem like docker, lxc and systemd-nspawn.
This project started back in 2018, with the aim to be more lightwieght, secure and also require no daemon to run the containers.
With each release podman is more and more compatible toward docker, and as stated on the podman project's page, it is not inteded to replace the docker, but to be an alternative to docker. If you compared any container technology, docker is the closeted to docker to be used as an developer friendly container tools to isolate the application on its own, and also an kubernetes compatible.&lt;/p&gt;
&lt;p&gt;Here is some key component of podman:&lt;br/&gt;
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Podman&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
Image and container image manager.
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Buildah&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
The container builder.
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Skopeo&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
A container image inspection manager.
&lt;li&gt; &lt;strong&gt;&lt;em&gt;runc&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
The container runner and feature builder for &lt;strong&gt;&lt;em&gt;podman&lt;/em&gt;&lt;/strong&gt; and &lt;strong&gt;&lt;em&gt;buildah&lt;/em&gt;&lt;/strong&gt;
&lt;li&gt; &lt;strong&gt;&lt;em&gt;crun&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt; 
Additional runtime that allow greater contorl and security for rootless containers.  &lt;/p&gt;
&lt;p&gt;Podman can be installed with default package manager on almost all linux variant without the need of external repositories, however old release distro will not get the latest version and it's new feature from the latest update.  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;On Debian / Ubuntu based distro you can install podman with.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo apt -y install podman podman-compose
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;On Fedora / Redhat / Centos / Alma / Rocky / Oracle linux.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo yum -y install epel-release 
&lt;span class="nv"&gt;$ &lt;/span&gt;sudo yum -y install container-tools
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On Centos 7, the latest available version of podman is 1.16, you can build dan compile podman on your own from source if you want to use the newer version.
&lt;strong&gt;&lt;em&gt;on Arch linux.&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;sudo pacman -Syyu podman buildah fuse-overlaysfs cni-plugins
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or add podman-docker packages if you want to use docker command to manage podman, 
and for new version replace cni-plugins with netavark ( since version 4.x ).&lt;/p&gt;
&lt;p&gt;To pull container with podman use this command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;podman&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pull&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;io&lt;/span&gt;&lt;span class="sr"&gt;/library/&lt;/span&gt;&lt;span class="n"&gt;nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To run grafana container, with container name grafana and expose port 3000 with podman use:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;podman&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;grafana&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3000&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3000&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;grafana&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;grafana&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In podman you can use shorted registery name like in the example above, or full registery name like this&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;podman&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;grafana&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3000&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3000&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docker&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;io&lt;/span&gt;&lt;span class="sr"&gt;/library/g&lt;/span&gt;&lt;span class="n"&gt;rafana&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;grafana&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For the latest version, podman currently support to build almost all Dockerfile and orchestrated container from docker-compose.yml file.
To build from Dockerfile:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;podman&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;build&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tage&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To use podman for run container from compose file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;podman&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sr"&gt;/path/&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;compose&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;yml&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;up&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="misc"></category></entry><entry><title>Install dan Setup Mariadb Cluster menggunakan Galera Cluster</title><link href="/install-dan-setup-mariadb-cluster-menggunakan-galera-cluster.html" rel="alternate"></link><published>2020-06-30T22:30:00+07:00</published><updated>2020-06-30T22:30:00+07:00</updated><author><name>me</name></author><id>tag:None,2020-06-30:/install-dan-setup-mariadb-cluster-menggunakan-galera-cluster.html</id><summary type="html">&lt;p&gt;Install dan konfigurasi Maridb Cluster&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;center&gt;&lt;img alt="mariadb galera" height="270" src="images/galera_cluster_logo.png" width="270"/&gt;&lt;/center&gt;
&lt;strong&gt;&lt;em&gt;Introduction:&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Untuk membuat Clustering Database system di MariaDB maka bisa menggunakan Galera. 
Galera sendiri sudah termasuk kedalam paket instalasi pada MariaDB sehingga tidak dibutuhkan instalasi paket tambahan.
Namun jika ingin menggunakan versi galera yang lebih tinggi seperti galera-3 di MariaDB 10.3 dan 
galera-4 di MariaDB 10.4 maka butuh menambahlak paket &lt;em&gt;galera-3&lt;/em&gt; dan &lt;em&gt;galera-4&lt;/em&gt; untuk menginstall 
wsrep provider librarynya.&lt;/p&gt;
&lt;p&gt;Beberapa Fitur yang ditawarkan dari Galera Cluster diantaranya:
&lt;ul&gt;
&lt;li&gt; &lt;strong&gt;&lt;em&gt;True Multi-Master&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
You can read and write to any node at any time. 
Changes to data on one node will be replicated on all. 
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Synchronous Replication&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
There is no slave lag, so no data is lost if a node crashes.
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Tightly Coupled&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
All nodes hold the same state. There is no diverged data between nodes. 
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Multi-Threaded Slave&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
This allows for better performance and for any workload. 
&lt;li&gt; &lt;strong&gt;&lt;em&gt;No Master-Slave Failover&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
There is no need for master-slave operations or to use VIP. 
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Hot Standby&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
There is no downtime related to failures or intentionally taking down a node 
for maintenance, since there is no failover. 
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Automatic Node Provisioning&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
There&amp;rsquo;s no need to backup manually the database and copy it to the new node. 
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Supports InnoDB&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
The InnoDB storage engine provides for transactional tables. 
&lt;li&gt; &lt;strong&gt;&lt;em&gt;Transparent to Applications&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
Generally, you won&amp;rsquo;t have to change an application that will interface with the database
 as a result of Galera. If you do, it will be minimal changes. 
&lt;li&gt; &lt;strong&gt;&lt;em&gt;No Read and Write Splitting Needed&lt;/em&gt;&lt;/strong&gt; &lt;/li&gt;
There is no need to split read and write queries.
&lt;/ul&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt;&lt;br/&gt;
&lt;span style="background-color: #FF9333"&gt; &lt;strong&gt;&lt;em&gt;Tutorial instalasi ini di test di Ubuntu 20.04, 22.04 dan Debian 10, 11. Untuk distro lainnya atau varian lainnya silahkan di test sendiri (DWYOR).&lt;/em&gt;&lt;/strong&gt;&lt;/span&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Requirements:&lt;/em&gt;&lt;/strong&gt;&lt;br/&gt;
3 server dengan OS Linux varian Ubuntu 20.04 atau Debian 10 fresh install dengan akses &lt;code&gt;root&lt;/code&gt; atau &lt;code&gt;sudo&lt;/code&gt; sebagai instance database server.
1 server dengan OS Linux varian Ubuntu 20.04 atau Debian 10 fresh install dengan akses &lt;code&gt;root&lt;/code&gt; atau &lt;code&gt;sudo&lt;/code&gt; sebagai instance proxy server.
(optional) server bisa saling terhubung menggunakan hostname&lt;/p&gt;
&lt;p&gt;Server yang digunakan:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;192.168.30.63   db1&lt;/span&gt;
&lt;span class="x"&gt;192.168.30.64   db2&lt;/span&gt;
&lt;span class="x"&gt;192.168.30.64   db3&lt;/span&gt;
&lt;span class="x"&gt;192.168.30.200  proxy&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Proses Instalasi:&lt;/em&gt;&lt;/strong&gt;&lt;br/&gt;
Seperti biasa lakukan update terlebih dahulu sebelum menginstall paket.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;apt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;update&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;apt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;install&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;mariadb&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;rsync&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Untuk Debian karena pada Debian 10 versi MariaDB-10 belum ada di repository, maka bisa menggunakan repo dari MariaDB&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;apt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;update&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;apt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;install&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;dirmngr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;software&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;properties&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;common&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;apt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;key&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;adv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nx"&gt;recv&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="nx"&gt;keyserver&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;hkp&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//keyserver.ubuntu.com:80 0xF1656F24C74CD1D8 &lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;add&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;apt&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;repository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;'&lt;/span&gt;&lt;span class="nx"&gt;deb&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;arch&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;amd64&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;//nyc2.mirrors.digitalocean.com/mariadb/repo/10.1/debian buster main'&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;apt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;update&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;apt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;install&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;mariadb&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;rsync&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Jalankan perintah itu untuk menginstall Mariadb di ketiga server.
Setelah selesai instalasi, setting password root untuk database dan selanjutnya kita akan matikan service terlebih dahulu karna kita akan melakukan konfigurasi.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;mysql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;root&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Kemudian setting password untuk MariaDB root&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;MariaDB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"p@55w0Rd123"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Jika sukses maka output seperti ini akan muncul
&lt;img alt="mariadb1 img!" src="images/mariadb1.png" title="mariadb password success"/&gt;
Selanjutnya keluar dari mariadb dengan perintah &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;MariaDB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;]&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Setlah itu kita akan melakukan config Galera, sebelum itu matikan terlebih dahulu servicenya.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;systemctl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;stop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;mariadb&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Setup Galera cluster&lt;/em&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;Konfigurasi Galera cluster ada di &lt;code&gt;/etc/mysql/mariadb.conf.d/50-galera.cnf&lt;/code&gt;
Edit file tersebut dan tambahkan config seperti berikut:
&lt;code&gt;$ sudo vim /etc/mysql/mariadb.conf.d/50-galera.cnf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mysqld&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;binlog_format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ROW&lt;/span&gt;
&lt;span class="n"&gt;default&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;engine&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;innodb&lt;/span&gt;
&lt;span class="n"&gt;innodb_autoinc_lock_mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;192.168.30.63&lt;/span&gt;

&lt;span class="c1"&gt;# Galera Provider Configuration&lt;/span&gt;
&lt;span class="n"&gt;wsrep_on&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ON&lt;/span&gt;
&lt;span class="n"&gt;wsrep_provider&lt;/span&gt;&lt;span class="o"&gt;=/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;lib&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;galera&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;libgalera_smm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;so&lt;/span&gt;

&lt;span class="n"&gt;wsrep_cluster_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"galera_cluster"&lt;/span&gt;
&lt;span class="n"&gt;wsrep_cluster_address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"gcomm://192.168.30.63,192.168.30.64,192.168.30.65"&lt;/span&gt;

&lt;span class="n"&gt;wsrep_sst_method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;rsync&lt;/span&gt;

&lt;span class="n"&gt;wsrep_node_address&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"192.168.30.63"&lt;/span&gt;
&lt;span class="n"&gt;wsrep_node_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"db1"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Karena kita sudah setting binding-address IP kita di &lt;strong&gt;50-galera.cnf&lt;/strong&gt; maka kita akan menghapus setting tersebut dari file &lt;strong&gt;50-server.cnf&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sed&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;'&lt;/span&gt;&lt;span class="nx"&gt;s&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;bind&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;address&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="nx"&gt;bind&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;address&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;g&lt;/span&gt;&lt;span class="err"&gt;'&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;mariadb&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;conf&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;d&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;server&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;cnf&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Selanjutnya edit di node berikutnya file &lt;strong&gt;50-galera.cnf&lt;/strong&gt; tersebut, isi dari config boleh di copy, yang perlu diubah hanya pada bagian berikut&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;wsrep_node_address=&lt;/span&gt;
&lt;span class="x"&gt;wsrep_node_name=&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ganti dengan hostname dan ip dari masing-masing server. &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Firwall Config (Optional)&lt;/em&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;Secara default biasanya Ubuntu dan Debian tidak mengaktifkan firewall service, namun untuk production sangat disarankan agar service tersebut dinyalakan. Untuk management firewall di Debian Base bisa menggunakan UFW ataupun Firewalld seperti di keluarga &lt;strong&gt;RedHat&lt;/strong&gt;, namun agar lebih seragam maka tutorial ini akan menggunakan UFW sebagai manajemen firewallnya.&lt;/p&gt;
&lt;p&gt;Port yang perlu di buka agar service-service yang dibutuhkan untuk Galera Cluster bisa berfungsi:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;3306&lt;/strong&gt; Port yang digunakan untuk MySQL/MariaDB Database berkomunikasi, merupakan default service port (meskipun port ini bisa diubah tetapi tidak direkomendasikan untuk mengubahnya).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;4567&lt;/strong&gt; Port untuk Galera Cluster Replication traffic. Multicast replication akan menggunakan UDP dan TCP pada port ini.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;4568&lt;/strong&gt; Port untuk incremental transfer state.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;4444&lt;/strong&gt; Port untuk fitur lain seperti snapshot dari galera service.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Untuk mengallow akses firewall pada ufw menggunakan command berikut:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;ufw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;allow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.30.0&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;proto&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;tcp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;any&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;port&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3306&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4567&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4568&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;ufw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;allow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.30.0&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;proto&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;udp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;to&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;any&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;port&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4567&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Perhatikan perintah diatas, ubah ip dan subnet sesuai dengan subnet yang digunakan, atau jika ingin mengallow ke semua &lt;strong&gt;(kurang aman dan kurang direkomendasikan)&lt;/strong&gt; bisa menggunakan perintah berikut:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;ufw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;allow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3306&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4567&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4568&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4444&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;tcp&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;ufw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;allow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4567&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;udp&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Start Galera Cluster&lt;/em&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;Selanjutnya start Galera Cluster dari node pertama&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;galera_new_cluster&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Selanjutnya cek status wsrep dengan login ke mysql shell&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;mysql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;p&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;"SHOW STATUS LIKE 'wsrep_cluster_size'"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Jika sukses maka akan muncul tampilan berikut:&lt;/p&gt;
&lt;p&gt;&lt;img alt="wsrep status " src="images/wsrep-img1.png"/&gt; &lt;/p&gt;
&lt;p&gt;Selanjutnya start service mariadb-server di node 2 dan 3&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;systemctl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;start&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;mysql&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;dan cek kembali wsrep status nya, jika server db node 2 dan 3 juga sukses, maka ukuran &lt;strong&gt;wsrep_cluster_size&lt;/strong&gt; nya akan bertambah seperti gambar berikut:
&lt;img alt="wsrep_status_node2 " src="images/wsrep-imgdb2.png"/&gt; &lt;img alt="wsrep_status_node3 " src="images/wsrep-img3.png"/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Setup Load Balance&lt;/em&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;&lt;center&gt;&lt;img alt="db load-balance" height="300" src="images/db-loadbalance.png" width="300"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;Setelah selesai setup cluster selanjutnya kita akan setting &lt;em&gt;load balancing&lt;/em&gt; untuk galera cluster ini. Tujuan load balance adalah untuk memastikan bahwa load terbagi dengan rata
antar semua server. Untuk load balance-nya kita bisa menggunakan haproxy, nginx maupun tools load balance lainnya.
Disini kita akan menggunakan Haproxy sebagai load-balancer server. Untuk menginstall haproxy di ubuntu atau debian jalankan perinta berikut:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;apt&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;haproxy&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Selanjutnya setup haproxy, sebaiknya kita copy terlebih dahulu default confignya.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;cp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;haproxy&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;haproxy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;cfg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;haproxy&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;haproxy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;orig&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Kemudian tambahkan baris berikut di bagian paling bawah dari config file di &lt;em&gt;/etc/haproxy/haproxy.cfg&lt;/em&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stats&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.30.73&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;8080&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;http&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;stats&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;enable&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;stats&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hide&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;version&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;stats&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;realm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Haproxy&lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Statistics&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;stats&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;stats&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;admin&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="mi"&gt;55&lt;/span&gt;&lt;span class="n"&gt;w0rd123&lt;/span&gt;

&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;galera_cluster&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;bind&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.30.73&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3306&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;balance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;source&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tcp&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;option&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tcpka&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;option&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;check&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;haproxy&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;option&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tcplog&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;db1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.30.70&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3306&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;check&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;db2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.30.71&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3306&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;check&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;db3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;192.168.30.72&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;3306&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;check&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Keterangan:
&lt;ul&gt;
&lt;li&gt;Listen stats = Setup statistic page dari Haproxy untuk monitoring matrics dari mysql cluster kita. &lt;/li&gt;
&lt;li&gt;bind = listen ip dan port yang digunakan untuk stats page dari haproxy. &lt;/li&gt;
&lt;li&gt;stats auth = Autentikasi untuk stats page, defaulnya tidak ada, jadi kita setup user dan passwordnya.&lt;/li&gt;
&lt;li&gt;stats enable = Menghidupkan module stats. &lt;/li&gt;
&lt;li&gt;Listen galera_cluster = Setting load balancer untuk galera cluster. &lt;/li&gt;
&lt;li&gt;balance = Type dari load balance yang akan digunakan, defaultnya adalah round-robin, disini kita menggunakan source atau Source IP Hash, yang berarti 
setiap request yang datang dari IP yang sama akan diarahkan ke taget backend yang sama. &lt;/li&gt;
&lt;li&gt;mode = Setting untuk connect mode, disini kita menggunakan mode tcp, karena mariadb connect melalui tcp ke haproxy.&lt;/li&gt;
&lt;li&gt; server = List alamat ip dan hostname beserta port dari server backend. &lt;/li&gt;&lt;/ul&gt;&lt;/p&gt;
&lt;p&gt;Yang perlu di perhatikan paling utama adalah sesuaikan IP di bagian server dan bind dengan server yang kalian gunakan.
Untuk opsi lainnya agar lebih jelas bisa di baca di &lt;a href="https://linux.die.net/man/1/haproxy"&gt;man page&lt;/a&gt; atau dokumentasi dari &lt;a href="https://docs.haproxy.org/2.8/configuration.html"&gt;haproxy&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Start Haproxy&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Selanjutnya start haproxy dan allow user haproxy untuk mengakses galera cluster, karna saat ini haproxy belum bisa connect ke mysql menggunakan password, maka kita akan membuat user yang support login ke mysql secara passwordless&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mysql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;

&lt;span class="n"&gt;MariaDB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;haproxy&lt;/span&gt;&lt;span class="err"&gt;@'&lt;/span&gt;&lt;span class="mf"&gt;192.168.30.73&lt;/span&gt;&lt;span class="err"&gt;'&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAX_QUERIES_PER_HOUR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MAX_UPDATES_PER_HOUR&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;MariaDB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;\&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Kemudian setting user untuk haproxy di &lt;em&gt;/etc/haproxy/haproxy.cfg&lt;/em&gt; untuk config tersebut ada di bagian atasi di sub menu global config
&lt;img alt="user haproxy" src="images/haproxy-user.png"/&gt;&lt;/p&gt;
&lt;p&gt;Sesuaikan user tersebut dengan user yang di buat di mysql untuk mengakses database.&lt;/p&gt;
&lt;p&gt;Selanjutnya start haproxy&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;systemctl&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;haproxy&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Kemudian cek statistic page dari haproxy di browser dengan mengakses &lt;code&gt;http://ip_haproxy:port&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Jika semua sukses maka tampilan seperti ini akan muncul:
&lt;center&gt;&lt;img alt="haproxy stat" height="450" src="images/haproxy_stat.png" width="450"/&gt;&lt;/center&gt;&lt;/p&gt;
&lt;p&gt;Jika halaman stat sudah muncul, berarti haproxy sudah sukses untuk terhubung dengan galera cluster, dan sudah dapat digunakan untuk load balance galera cluster.
Selanjutnya untuk menggunakan cluster ini maka kita akan mengakses melalui haproxy ini.&lt;/p&gt;
&lt;p&gt;Sampai disini dulu tutorial nya.&lt;/p&gt;</content><category term="misc"></category><category term="Mariadb"></category><category term="linux"></category><category term="database"></category><category term="cluster"></category></entry><entry><title>Use LVM-cache for Storage Tiering to speed up spinning disk with small SSD.</title><link href="/use-lvm-cache-for-storage-tiering-to-speed-up-spinning-disk-with-small-ssd.html" rel="alternate"></link><published>2019-01-03T23:59:51+07:00</published><updated>2023-07-23T13:00:00+07:00</updated><author><name>me</name></author><id>tag:None,2019-01-03:/use-lvm-cache-for-storage-tiering-to-speed-up-spinning-disk-with-small-ssd.html</id><summary type="html">&lt;p&gt;How to setup lvm-cache&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt;&lt;em&gt;SSD VS HDD&lt;/em&gt;&lt;/strong&gt;&lt;br/&gt;
SSD are much faster nand-flash based disk, but also more expensive and smaller in size comparing to the spinning hard-disk which come in bigger size and relatively cheaper but much slower.&lt;br/&gt;
Futermore SSD also comes with &lt;a href="https://blog.westerndigital.com/ssd-endurance-speeds-feeds-needs/"&gt;wear-out penalty&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Hybrid Solution ?&lt;/em&gt;&lt;/strong&gt;&lt;br/&gt;
In the market there are so-called "Hybrid HDD or SSHD" which use small in chip ssd as the cache for the HDD, but the size of ssd used in these product usually really small and furthermore you cannot tune the cache, nor you can get any statistics about the hits and missed cache.
And nowdays in the modern day, there are much newer NVME interface which much faster compared to the old school SATA III port.
So hardware hybrid solution like SSHD which utilize sata III interface no longer can compete against software solution which can use super fast nvme as the cache of the hdd.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;What is LVM&lt;/em&gt;&lt;/strong&gt;&lt;br/&gt;
What is LVM? LVM are the Logical Volume Manager tools which includes allocating disk, striping, mirror, resize, raid (utilize the mdadm) the logical volumes.&lt;br/&gt;
With LVM a hard drive or set of hard drive allocated to be one or more physical volumes. LVM physical volume can be placed on another block devices which might span more disk.  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;What is LVM-cache?&lt;/em&gt;&lt;/strong&gt; &lt;br/&gt;
Quotes from the man page &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The cache logical volume type uses a small and fast LV to improve the performance 
of a large and slow LV. It does this by storing the frequently used blocks 
on the faster LV. LVM refers to the small fast LV as a cache pool LV. 
The large slow LV is called the origin LV. Due to requirements from dm-cache 
(the kernel driver), LVM further splits the cache pool LV into two devices - the cache 
data LV and cache metadata LV. The cache data LV is where copies of data blocks are 
kept from the origin LV to increase speed. The cache metadata LV holds the accounting 
information that specifies where data blocks are stored (e.g. on the origin LV or on 
the cache data LV). Users should be familiar with these LVs if they wish to create 
the best and most robust cached logical volumes. 
All of these associated LVs must be in the same VG.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So we can say LVM-cache is the technique to utilize the set of ssd which come in smaller size but much faster to improve the performance of much bigger size spinning hard-drive.  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cache Implementation:&lt;/strong&gt;&lt;br/&gt;
There are two available implementation technique of LVM-cache: 
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;dm-cache&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;&lt;br/&gt;
Provides both write and read-cache and is used where not only write operations are 
critical but also read operations. 
Benefit of dm-cache over dm-writecache is that the cache can be created, 
activated and destroyed online. 
&lt;li&gt;&lt;strong&gt;&lt;em&gt;dm-writecache&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;&lt;br/&gt;
Provide only write cache, but no read cache. dm-writecache has less overhead 
because there will be no promotion/demotion of data for read caches, 
performance tests show slightly better results with dm-writecache over dm-cache. 
Use cases are from my point of view a bit limited as there is no read cache. 
If you need the maximum possible performance on write operations, 
then dm-writecache is your choice. 
Be aware that for creating the cache, the LV must be offline.
&lt;/ul&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The initial of this blog-post is written in 2019, at the time of write, dm-writecache still not available on the Debian 9, Fedora 30 nor Redhat 8.0 Beta.
And this post will focused on the &lt;strong&gt;dm-cache&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Cache Methods&lt;/strong&gt;&lt;br/&gt;
Beside the cache technique, there are also two methods of how the cache utilized: 
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;cachepool&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
Cachepool use two logical volumes to store the cache and cache metadata. This methods had better throughput
also if you have multiple volume to be cached, this method is better options.
&lt;li&gt;&lt;strong&gt;&lt;em&gt;cache volumes&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
Cache volume utilized single logical volume for both cache and cache metadata. This methods is easier to setup.
&lt;/ul&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cache Mode:&lt;/strong&gt;&lt;br/&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Write-back&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
In Write-back the write commit is done when the data is written to the cache device only. This mode provide better performance,
but you may consider to use redundant cache device if it used on critical mission data, because if the cache device got lost 
before it complete the write to the backing device, all of your &lt;em&gt;uncommited&lt;/em&gt; data will be lost. 
&lt;li&gt;&lt;strong&gt;&lt;em&gt;Write-through&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
This cache mode is more secure, because the write will be commited if data already writen to the backing device, but also mean more or less useless. Because you  will not gain any write speed from the cache device.
&lt;/ul&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;The test:&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Assuming you already have the LVM setup on some harddiks, and we will use the &lt;em&gt;untouched&lt;/em&gt; SSD for the cache device.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pvcreate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sdX&lt;/span&gt;
&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vgextend&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MY_VOLGROUP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sdX&lt;/span&gt;
&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lvcreate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;XMB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MY_VOLGROUP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sdX&lt;/span&gt;
&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lvcreate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;99&lt;/span&gt;%&lt;span class="n"&gt;PVS&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MY_VOLGROUP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;sdX&lt;/span&gt;
&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lvconvert&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;pool&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;cachemode&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;writeback&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;poolmetadata&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MY_VOLGROUP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;meta&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MY_VOLGROUP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;
&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lvconvert&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="n"&gt;cachepool&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MY_VOLGROUP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MY_VOLGROUP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;backed_lv&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Things to notice:&lt;/strong&gt;
&lt;li&gt; /dev/sdX is your SSD device (e.g if it labeled as /dev/sdb use it instead, check your devices label with &lt;code&gt;lsblk&lt;/code&gt; command&lt;/li&gt;
&lt;li&gt;MY_VOLGROUP is the name of your Volume Group Name&lt;/li&gt;
&lt;li&gt; XMB is the size of metadata cache, there is no official rules about this metadata size's on the documentation, it only stated the size should not less than 8MB. 
In my machine I use the 128GB SSD as the cache device, so I will alocated 128MB for the metadata size&lt;/li&gt;
&lt;li&gt; 99%PVS is all available free size of my SSD will be used as the cache device, again there is no rule of thumbs about how big should the cache size. So it will be based on your workload and available cache-device &lt;span&gt;😀&lt;/span&gt;&lt;/li&gt;&lt;br/&gt;
&lt;li&gt; backed_lv will be your logical volume to be cached&lt;/li&gt;&lt;/p&gt;
&lt;p&gt;After finished to setup the LVM cache, now it's time to rebuild the initramfs, so the LV cache module included in kernel.&lt;/p&gt;
&lt;p&gt;For Debian base install the &lt;em&gt;thin-provisioning-tools&lt;/em&gt; package first&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;apt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;install&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;thin&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;provisioning&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;tools&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;then copy this simple script into &lt;em&gt;/etc/initramfs-tools/hooks&lt;/em&gt; and rebuild the initramfs&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;EOF&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sr"&gt;/etc/i&lt;/span&gt;&lt;span class="n"&gt;nitramfs&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;tools&lt;/span&gt;&lt;span class="sr"&gt;/hooks/&lt;/span&gt;&lt;span class="n"&gt;lvmcache&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;span class="c1"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="n"&gt;PREREQ&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;"lvm2"&lt;/span&gt;

&lt;span class="n"&gt;prereqs&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;"$PREREQ"&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;case&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;
&lt;span class="n"&gt;prereqs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;prereqs&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
&lt;span class="n"&gt;esac&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sr"&gt;/usr/s&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cache_check&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="n"&gt;fi&lt;/span&gt;

&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sr"&gt;/usr/s&lt;/span&gt;&lt;span class="n"&gt;hare&lt;/span&gt;&lt;span class="sr"&gt;/initramfs-tools/&lt;/span&gt;&lt;span class="n"&gt;hook&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;functions&lt;/span&gt;

&lt;span class="n"&gt;copy_exec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sr"&gt;/usr/s&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cache_check&lt;/span&gt;

&lt;span class="n"&gt;manual_add_modules&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dm_cache&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dm_cache_mq&lt;/span&gt;

&lt;span class="n"&gt;EOF&lt;/span&gt;

&lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;chmod&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sr"&gt;/etc/i&lt;/span&gt;&lt;span class="n"&gt;nitramfs&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;tools&lt;/span&gt;&lt;span class="sr"&gt;/hooks/&lt;/span&gt;&lt;span class="n"&gt;lvmcache&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;span class="nv"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;initramfs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;k&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For Fedora and RedHat Base:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;dracut&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That's all about the Storage Tiering with LVM cache, in the future maybe I'll post about the result and benchmark on another post. &lt;/p&gt;
&lt;p&gt;Refference:&lt;br/&gt;
&lt;a href="https://blog.delouw.ch/2020/01/29/using-lvm-cache-for-storage-tiering/"&gt;This nice post&lt;/a&gt;&lt;br/&gt;
&lt;a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/logical_volume_manager_administration/lvm_cache_volume_creation"&gt;should be&lt;/a&gt;&lt;br/&gt;
&lt;a href="https://support.mayfirst.org/wiki/lvm-cache"&gt;your refference&lt;/a&gt;&lt;/p&gt;</content><category term="misc"></category></entry><entry><title>Apa itu Cluster?</title><link href="/apa-itu-cluster.html" rel="alternate"></link><published>2014-06-10T13:30:00+07:00</published><updated>2014-06-10T13:30:00+07:00</updated><author><name>me</name></author><id>tag:None,2014-06-10:/apa-itu-cluster.html</id><summary type="html">&lt;p&gt;Mengenal apa itu Clustering system&lt;/p&gt;</summary><content type="html">&lt;p&gt;Apa itu Cluster?&lt;/p&gt;
&lt;p&gt;&lt;img alt="cluster img!" src="images/cluster-img2.png" title="cluster2.img"/&gt;&lt;/p&gt;
&lt;p&gt;Teknik Clustering di dalam system komputer adalah teknik menggabungkan beberapa server atau instance menjadi sebuah resource system yang bisa digunakan untuk berbagai keperluan.
Clustering pada system komputer sendiri bisa merupakan Hardware Cluster maupun Software Cluster.&lt;/p&gt;
&lt;p&gt;Secara umum cluster bisa di kategorikan dalam 3 tipe, yaitu &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Load Balancing Cluster
Cluster dengan mode Load Balance bekerja dengan membagi (distribusi) beban ke beberapa resource yang ada, sehingga tidak terjadi overload pada salah satu server  dan menyebabkan pengguna tidak dapat mengakses system atau aplikasi.&lt;/li&gt;
&lt;li&gt;High Avability Cluster
Sedangkan High Avability Cluster adalah type cluster yang memastikan system atau service selalu bisa diakses meskipun ada salah satu server yang mati / down.&lt;/li&gt;
&lt;li&gt;Fail-Over-Cluster
Cluster mode ini bekerja dengan cara hot-standby atau master-slave, sehingga sebenarnya hanya server yang akan bekerja pada satu waktu, namun jika master atau server utama mengalami down atau gangguan, maka slave atau hot-stanby server akan mengambil alih.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="cluster image!" src="images/cluster-img1.png" title="clustering model"/&gt;&lt;/p&gt;
&lt;p&gt;Clustering pada system komputer memiliki benefit diantaranya:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;High Avability &lt;/li&gt;
&lt;li&gt;Redundancy / Fault Tolerance&lt;/li&gt;
&lt;li&gt;Scalability&lt;/li&gt;
&lt;li&gt;Load Balance&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Meski memiliki benefit, namun clustering system sendiri juga memiliki kekurangan diantaranya:
* High Cost
* Not easy to Setup and Maintain&lt;/p&gt;</content><category term="misc"></category><category term="server"></category><category term="cluster"></category><category term="load-balance"></category><category term="ha"></category></entry></feed>